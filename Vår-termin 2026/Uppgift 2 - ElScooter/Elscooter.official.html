<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Elscooter.css">
    <title>VHDeS.se Official</title>
</head>
<body>
    <div class="header">
        <h1>Hyr en ElScooter, hos VHDes</h1>
        <h2 id="ValkommstText">Välkommen, Tage!</h2>
    </div>
    <div class="content">
    <p id="pris">En elscooter har ett startpris på 10 kr, och därefter kostar det 5 kr/minut.</p>
    <p id="elscooterStatus" class="status">Ingen elscooter hyrd</p>
    <p id="kostnadText">Kostnad: 0 kr</p>

    <button id="hyrKnapp">Hyr elscooter</button>
    <button id="lamnaTillbakaKnapp">Lämna tillbaka</button>
    <button id="BetalaKnapp">Betala</button>
    
    <div id="uthyrningsHistorik"></div> 
    </div>
    <script>
        const parametrar = new URLSearchParams(window.location.search); // Hämtar URL-parametrar
        const anvandarnamn = parametrar.get("anvandarnamn"); // Hämtar värdet av "anvandarnamn" från URL-parametrarna
        const hyrKnapp = document.getElementById("hyrKnapp"); // Hämtar knappen för att hyra elscooter
        const lamnaTillbakaKnapp = document.getElementById("lamnaTillbakaKnapp"); // Hämtar knappen för att lämna tillbaka elscooter
        const elscooterStatus = document.getElementById("elscooterStatus"); // Hämtar elementet som visar status för elscootern
        const uthyrningsHistorik = document.getElementById("uthyrningsHistorik"); // Hämtar elementet som visar uthyrningshistoriken
        const kostnadText = document.getElementById("kostnadText"); // Hämtar elementet som visar kostnaden
        const betalaKnapp = document.getElementById("BetalaKnapp");// Hämtar knappen för att betala
        const prisPerMinut = 5; // Kostnad per minut efter startpriset
        const startPris = 10; // Startpris för att hyra elscootern
        let kostnadsTimer = null; // Variabel för att hålla referensen till timer som uppdaterar kostnaden
        let totalBetalning = 0; // Variabel för att hålla den totala betalningen inklusive eventuella skulder
        let uthyrningsStartTid = null; // Variabel för att hålla starttiden för uthyrningen
        let ObetaldaSkulder = 0; // Variabel för att hålla eventuella obetalda skulder
        let antalScootrar = 0; // Variabel för att hålla antalet hyrda scootrar

        lamnaTillbakaKnapp.style.display = "none"; // Dölj "Lämna tillbaka"

        hyrKnapp.addEventListener("click", function () { // Event listener för att hantera när användaren klickar på "Hyr elscooter"-knappen
            uthyrningsStartTid = new Date(); // Sätter starttiden för uthyrningen till den aktuella tiden

            elscooterStatus.textContent = "Elscooter är hyrd"; // Uppdaterar statusen för elscootern till "Elscooter är hyrd"
            elscooterStatus.classList.add("rented"); // Lägger till klassen "rented" för att ändra utseendet på statusen

            hyrKnapp.disabled = true;// Inaktiverar "Hyr elscooter"-knappen för att förhindra att användaren hyr flera scootrar samtidigt
            lamnaTillbakaKnapp.style.display = "inline-block";// Visar "Lämna tillbaka"-knappen

            kostnadText.innerText = "Kostnad just nu: " + startPris + " kr";// Uppdaterar kostnadstexten för att visa startpriset
                kostnadsTimer = setInterval(function () {// Startar en timer som uppdaterar kostnaden varje minut
                    const nu = new Date();// Hämtar den aktuella tiden
                const minuter = Math.floor(// Beräknar antalet hela minuter som har gått sedan uthyrningen startade
            (nu - uthyrningsStartTid) / 60000 // Omvandlar millisekunder till minuter
        );
                    const kostnad = startPris + (minuter * prisPerMinut);// Beräknar den totala kostnaden baserat på startpriset och kostnaden per minut
            kostnadText.innerText ="Kostnad just nu: " + kostnad + " kr";// Uppdaterar kostnadstexten för att visa den aktuella kostnaden
            }, 60000); // Timer uppdateras varje minut (60000 millisekunder)
        });

        lamnaTillbakaKnapp.addEventListener("click", function () { // Event listener för att hantera när användaren klickar på "Lämna tillbaka"-knappen
            const uthyrningsSlutTid = new Date(); // Sätter slutetiden för uthyrningen till den aktuella tiden
            const minuter = Math.floor( // Beräknar antalet hela minuter som har gått under uthyrningen
            (uthyrningsSlutTid - uthyrningsStartTid) / 60000 // Omvandlar millisekunder till minuter
        );
            const kostnadDennaGang = startPris + (minuter * prisPerMinut); // Beräknar kostnaden för denna uthyrning baserat på startpriset och kostnaden per minut
                totalBetalning = ObetaldaSkulder + kostnadDennaGang; // Uppdaterar den totala betalningen genom att lägga till eventuella obetalda skulder och kostnaden för denna uthyrning
                ObetaldaSkulder = totalBetalning; // Uppdaterar obetalda skulder till den nya totala betalningen

        uthyrningsHistorik.innerText =
        "Du hyrde elscootern i " + minuter +
        " minuter.\nStartavgift: " + startPris + " kr." +
        "\nDenna gång kostade det: " +
        kostnadDennaGang + " kr." +
        "\nTidigare skuld: " +
        (totalBetalning - kostnadDennaGang) + " kr." +
        "\nTotalt att betala: " +
        totalBetalning + " kr."; // Uppdaterar uthyrningshistoriken med detaljer om den senaste uthyrningen, inklusive tid, kostnad och eventuella skulder

        elscooterStatus.innerText = "Ingen elscooter hyrd"; // Uppdaterar statusen för elscootern till "Ingen elscooter hyrd"
        elscooterStatus.classList.remove("rented");// Tar bort klassen "rented" för att återställa utseendet på statusen
            hyrKnapp.disabled = false;// Aktiverar "Hyr elscooter"-knappen igen så att användaren kan hyra en ny scooter
        lamnaTillbakaKnapp.style.display = "none";// Dölj "Lämna tillbaka"-knappen igen
        
            clearInterval(kostnadsTimer);// Stoppar timern som uppdaterar kostnaden varje minut
        kostnadText.innerText = "Kostnad: 0 kr";// Återställer kostnadstexten till "Kostnad: 0 kr" efter att uthyrningen är avslutad
        });

        betalaKnapp.addEventListener("click", function () {// Event listener för att hantera när användaren klickar på "Betala"-knappen
            if (ObetaldaSkulder > 0) {// Kontrollerar om det finns några obetalda skulder
                alert("Du har betalat " + ObetaldaSkulder + " kr.");// Visar en alert med det belopp som användaren har betalat
                    ObetaldaSkulder = 0;// Återställer obetalda skulder till 0 efter att betalningen har genomförts
                    totalBetalning = 0;// Återställer obetalda skulder och total betalning till 0 efter att betalningen har genomförts
                    uthyrningsHistorik.innerText += "\n\nBetalning genomförd.";// Uppdaterar uthyrningshistoriken för att visa att betalningen har genomförts
        } 
            else {// Om det inte finns några obetalda skulder, visar en alert som informerar användaren om att de inte har några skulder att betala
                alert("Du har inga skulder att betala.");// Visar en alert som informerar användaren om att de inte har några skulder att betala
        }
        });
    </script>
</body>
</html>